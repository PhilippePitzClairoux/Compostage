<?php

    include_once("../controller/data_management/user.php");
    include_once("../controller/SecurityUtils.php");

    if (!empty($_POST["username"])) {

        try {

            $user = user::loadWithId(sanitize_input($_POST["username"]));

            $question = $user->getUserAuthQuestion();
            $username = $user->getUsername();

            echo "<!DOCTYPE html>
                    <html lang='en' dir='ltr'>
                    <head>
                        <meta charset='utf-8'>
                        <link rel='stylesheet' href='style.css'>
                        <title>Recover password</title>
                    </head>
                    <body class="col-10 col-m-12 col-t-12">

                        <header class="col-12 col-m-12 col-t-12">
                            <div>
                                <img src="logo.png">
                            </div>
                    
                            <nav class="col-12 col-m-12 col-t-12">
                                <ul class="col-12 col-m-12 col-t-12">
                                    <a href="dashboard.html"><li class="col-3 col-m-12 col-t-3 elementNav">Main</li></a>
                                    <a href=""><li class="col-3 col-m-12 col-t-3 elementNav">page2</li></a>
                                    <a href=""><li class="col-3 col-m-12 col-t-3 elementNav">page3</li></a>
                                    <a href="stats.html"><li class="col-3 col-m-12 col-t-3 elementNav">page4</li></a>
                                </ul>
                            </nav>
                        </header>
                    <div class='divform'>
                        <form class='form col-12 col-m-12 col-t-12' action='../controller/PasswordRecovery.php' method='post'>
                            <label class='title'>Riddle me this : <br> $question </label><br><br><br>
                            <input type='text' name='answer' class='txtBox' placeholder='Answer' autocomplete='off'><br><br><br>
                            <input type='hidden' name='username' value='$username'>
                            <input type='submit' name='confirmbtn' class='button red' value='Verify answer'>
                            <input type='button' onclick='location.href=\"login_page.html\"' class='button red' value='Cancel'>
                        </form>
                    </div>
                    <footer class="footer col-12 col-m-12 col-t-12">
                        <div>
                            &copy; Copyright 2019 ANNELIDA
                        </div>
                    </footer>
                    </body>
                    </html>";

        } catch (Exception $e) {

            echo "Error log : " . $e->getMessage();
        }


    } else {

        echo "<p>Please input a username!</p><br>";

    }